<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Booth Profile - CSC Conference</title>
    <link rel="stylesheet" href="https://use.typekit.net/ilr6ctr.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'davis-sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background image - right side only in landscape */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 20%;
            height: 100%;
            background: url('https://images.squarespace-cdn.com/content/v1/5cf7db4cc0827b0001c9ff81/b115546f-0ea2-4efc-8401-79d0991119ce/Background+art.png?format=2500w') no-repeat right center;
            background-size: cover;
            z-index: -1;
        }

        /* Hide background in portrait orientation */
        @media (orientation: portrait) {
            body::before {
                display: none;
            }
        }

        .wizard-container {
            display: flex;
            width: 87.5vw;
            height: calc(87.5vw * 9 / 16); /* Maintain 16:9 aspect ratio */
            margin: 0 auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            border-radius: 20px;
            border: 3px solid #000000;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        /* When background disappears (portrait), use different sizing if needed */
        @media (orientation: portrait) {
            .wizard-container {
                width: 87.5vw;
                height: calc(87.5vw * 9 / 16);
            }
        }

        /* Sidebar */
        .sidebar {
            width: 23%;
            background: #e6e6e6;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 2;
        }

        .logo-section {
            margin-bottom: 40px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            height: 80px;
        }

        .logo {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
        }

        .logo-text {
            flex: 1;
            height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .conference-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 18px;
            color: #000000;
            line-height: 1.1;
            margin: 0;
        }

        .booth-number {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 45px;
            color: #000000;
            margin: 0;
            line-height: 1;
        }

        /* Step Navigation */
        .step-navigation {
            flex: 1;
        }

        .step-item {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 12px 0;
        }

        .step-item:hover {
            opacity: 0.7;
        }

        .step-item.active {
            opacity: 1;
        }

        .step-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: #f2f2f2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            transition: all 0.2s ease;
            position: relative;
        }

        .step-number svg {
            width: 28px;
            height: 28px;
            fill: #666666;
        }

        .step-item.active .step-number {
            background: #0071bc;
        }

        .step-item.active .step-number svg {
            fill: #ffffff;
        }

        .step-item.completed .step-number {
            background: #28a745;
        }

        .step-item.completed .step-number svg {
            fill: #ffffff;
        }

        .step-title {
            font-weight: 500;
            font-size: 16px;
            color: #333333;
        }

        .step-item.active .step-title {
            color: #000000;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 60px 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Welcome Screen */
        .welcome-section {
            max-width: 600px;
        }

        .welcome-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 48px;
            color: #000000;
            margin-bottom: 30px;
            line-height: 1.1;
        }

        .welcome-text {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 18px;
            color: #808080;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .get-started-btn {
            background: #0071bc;
            color: #ffffff;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .get-started-btn:hover {
            background: #005a94;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 113, 188, 0.3);
        }

        /* Loading State */
        .loading {
            display: none;
            text-align: center;
            padding: 60px;
        }

        .spinner {
            border: 4px solid #f2f2f2;
            border-top: 4px solid #0071bc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            color: #808080;
        }

        /* Error State */
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        /* Success State */
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }

        .success h3 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        /* Navigation Buttons */
        .navigation-buttons {
            position: absolute;
            bottom: 60px;
            right: 80px;
            display: flex;
            gap: 16px;
        }

        .nav-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .nav-btn-secondary {
            background: #f2f2f2;
            color: #666666;
        }

        .nav-btn-secondary:hover {
            background: #e6e6e6;
        }

        .nav-btn-primary {
            background: #0071bc;
            color: #ffffff;
        }

        .nav-btn-primary:hover {
            background: #005a94;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Mobile Progress Bar */
        .mobile-progress {
            display: none;
            height: 4px;
            background: #e6e6e6;
            position: relative;
            margin-bottom: 20px;
        }

        .mobile-progress-fill {
            height: 100%;
            background: #0071bc;
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        @media (orientation: portrait), (max-width: 768px) {
            body::before {
                display: none;
            }
            
            .wizard-container {
                position: static;
                transform: none;
                width: 100%;
                height: auto;
                min-height: 100vh;
                margin: 0;
                border-radius: 0;
                border: none;
                flex-direction: column;
                box-shadow: none;
            }

            .sidebar {
                width: 100%;
                padding: 20px;
                box-shadow: none;
                border-bottom: 1px solid #cccccc;
            }

            .logo-section {
                height: auto;
                margin-bottom: 20px;
            }

            .logo {
                width: 40px;
                height: 40px;
            }

            .logo-text {
                height: auto;
            }

            .conference-title {
                font-size: 14px;
                margin-bottom: 8px;
            }

            .booth-number {
                font-size: 24px;
            }

            .step-navigation {
                display: none;
            }

            .mobile-progress {
                display: block;
            }

            .main-content {
                padding: 40px 20px;
            }

            .welcome-title {
                font-size: 32px;
            }

            .navigation-buttons {
                position: static;
                justify-content: center;
                margin-top: 40px;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 28px;
            }

            .welcome-text {
                font-size: 16px;
            }

            .navigation-buttons {
                flex-direction: column;
                width: 100%;
            }

            .nav-btn {
                width: 100%;
            }

            .booth-number {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <img src="https://images.squarespace-cdn.com/content/v1/5cf7db4cc0827b0001c9ff81/3c43cc7d-5f2a-4b5e-888e-887d3bb38ebc/Logo+Only.png?format=750w" alt="Campus Stores Conference" class="logo">
                <div class="logo-text">
                    <div class="conference-title">CAMPUS STORES<br>CONFERENCE</div>
                    <div class="booth-number" id="boothNumber">Booth 501</div>
                </div>
            </div>

            <div class="step-navigation">
                <div class="step-item active" data-step="0">
                    <div class="step-number">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.01 28.01">
                            <path d="M14.01,28.01C6.28,28.01,0,21.73,0,14.01S6.28,0,14.01,0s14.01,6.28,14.01,14.01-6.28,14.01-14.01,14.01ZM14.01,2C7.39,2,2,7.39,2,14.01s5.39,12.01,12.01,12.01,12.01-5.39,12.01-12.01S20.63,2,14.01,2Z"/>
                            <path d="M13.25,22.55v-13.78l-1.63.89-1.06-1.8,4.51-2.4h.38v17.09h-2.21Z"/>
                        </svg>
                    </div>
                    <div class="step-title">Company information</div>
                </div>
                <div class="step-item disabled" data-step="1">
                    <div class="step-number">2</div>
                    <div class="step-title">Conference highlight</div>
                </div>
                <div class="step-item disabled" data-step="2">
                    <div class="step-number">3</div>
                    <div class="step-title">Conference team</div>
                </div>
                <div class="step-item disabled" data-step="3">
                    <div class="step-number">4</div>
                    <div class="step-title">Product catalogue</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Mobile Progress Bar -->
            <div class="mobile-progress">
                <div class="mobile-progress-fill" style="width: 0%"></div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading your profile information...</div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error">
                <strong>Oops!</strong> <span id="errorMessage"></span>
            </div>

            <!-- Success State -->
            <div id="successState" class="success">
                <h3>✅ Profile Updated Successfully!</h3>
                <p>Thank you for completing your booth profile. Your information is now under review and will appear on the conference map once approved.</p>
            </div>

            <!-- Welcome Screen -->
            <div id="welcomeSection" class="content-section active">
                <div class="welcome-section">
                    <h1 class="welcome-title">Welcome</h1>
                    <p class="welcome-text">
                        This is a welcome screen. We'll write an intro paragraph that instructs people to 
                        have contacts, products, and maybe a conference sale or highlight item ready.
                    </p>
                    <p class="welcome-text">
                        We're going to warn them that this stuff will go live to the conference map, that 
                        while there is a human reviewing the information we are mostly there to make sure 
                        that it looks good on the map, not that it is factually accurate.
                    </p>
                    <p class="welcome-text">
                        We'll also let them know that they will need to complete the process to save. Not 
                        everything needs to be done, but we do need them to hit submit for their answers to 
                        be uploaded.
                    </p>
                    <p class="welcome-text">
                        Then we'll thank them again for being a partner. That we really appreciate them 
                        doing this and that we're happy to have them come to the conference.
                    </p>
                    <button class="get-started-btn" onclick="startWizard()">
                        Get started
                        <span>→</span>
                    </button>
                </div>
            </div>

            <!-- Step 1: Company Information -->
            <div id="step1Section" class="content-section">
                <h2>Company Information</h2>
                <!-- Content will be added here -->
            </div>

            <!-- Step 2: Conference Highlight -->
            <div id="step2Section" class="content-section">
                <h2>Conference Highlight</h2>
                <!-- Content will be added here -->
            </div>

            <!-- Step 3: Conference Team -->
            <div id="step3Section" class="content-section">
                <h2>Conference Team</h2>
                <!-- Content will be added here -->
            </div>

            <!-- Step 4: Product Catalogue -->
            <div id="step4Section" class="content-section">
                <h2>Product Catalogue</h2>
                <!-- Content will be added here -->
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons" id="navigationButtons" style="display: none;">
                <button class="nav-btn nav-btn-secondary" onclick="previousStep()" id="prevBtn">Previous</button>
                <button class="nav-btn nav-btn-primary" onclick="nextStep()" id="nextBtn">Next</button>
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        // WIZARD STATE MANAGEMENT
        // ===========================================
        let currentStep = 0;
        const totalSteps = 4;
        let vendorData = {};
        let organizationContacts = [];
        let conferenceTeam = [];

        const API_BASE = '/api';

        // ===========================================
        // INITIALIZATION
        // ===========================================
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check for OAuth callback success/error
            if (urlParams.get('success') === 'true') {
                console.log('🎉 OAuth callback success!');
                showSuccessState();
                return;
            }
            
            if (urlParams.get('error')) {
                const error = urlParams.get('error');
                console.error('❌ OAuth callback error:', error);
                showErrorState(getErrorMessage(error));
                return;
            }
            
            // Normal page load - get token and load vendor data
            const token = urlParams.get('token');
            if (!token) {
                showErrorState('Invalid access link. Please check your email for the correct URL.');
                return;
            }

            try {
                console.log('🪄 Loading vendor data for token:', token);
                await loadVendorData(token);
                showWelcomeScreen();
            } catch (error) {
                console.error('Error loading vendor data:', error);
                showErrorState('Unable to load your profile information. Please try again later.');
            }
        });

        // ===========================================
        // WIZARD NAVIGATION
        // ===========================================
        function startWizard() {
            currentStep = 1;
            showStep(currentStep);
            updateStepNavigation();
            showNavigationButtons();
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                updateStepNavigation();
                updateMobileProgress();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateStepNavigation();
                updateMobileProgress();
            }
        }

        function showStep(stepNumber) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));

            // Show welcome or specific step
            if (stepNumber === 0) {
                document.getElementById('welcomeSection').classList.add('active');
            } else {
                document.getElementById(`step${stepNumber}Section`).classList.add('active');
            }

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn && nextBtn) {
                prevBtn.disabled = stepNumber <= 1;
                nextBtn.textContent = stepNumber === totalSteps ? 'Submit' : 'Next';
            }
        }

        function updateStepNavigation() {
            const stepItems = document.querySelectorAll('.step-item');
            
            stepItems.forEach((item, index) => {
                const stepIndex = index + 1;
                
                item.classList.remove('active', 'completed', 'disabled');
                
                if (stepIndex === currentStep) {
                    item.classList.add('active');
                } else if (stepIndex < currentStep) {
                    item.classList.add('completed');
                } else {
                    item.classList.add('disabled');
                }
            });
        }

        function updateMobileProgress() {
            const progressFill = document.querySelector('.mobile-progress-fill');
            const progressPercent = ((currentStep - 1) / (totalSteps - 1)) * 100;
            progressFill.style.width = `${Math.max(0, progressPercent)}%`;
        }

        function showNavigationButtons() {
            document.getElementById('navigationButtons').style.display = 'flex';
        }

        function hideNavigationButtons() {
            document.getElementById('navigationButtons').style.display = 'none';
        }

        // ===========================================
        // STATE MANAGEMENT
        // ===========================================
        function showWelcomeScreen() {
            showStep(0);
            hideNavigationButtons();
            hideLoadingState();
            hideErrorState();
            hideSuccessState();
        }

        function showLoadingState() {
            document.getElementById('loadingState').style.display = 'block';
            hideErrorState();
            hideSuccessState();
        }

        function hideLoadingState() {
            document.getElementById('loadingState').style.display = 'none';
        }

        function showErrorState(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').style.display = 'block';
            hideLoadingState();
            hideSuccessState();
        }

        function hideErrorState() {
            document.getElementById('errorState').style.display = 'none';
        }

        function showSuccessState() {
            document.getElementById('successState').style.display = 'block';
            hideLoadingState();
            hideErrorState();
            hideNavigationButtons();
        }

        function hideSuccessState() {
            document.getElementById('successState').style.display = 'none';
        }

        function getErrorMessage(error) {
            switch (error) {
                case 'oauth_denied':
                    return 'Google Drive authorization was denied. Your profile was saved without files.';
                case 'oauth_invalid':
                    return 'Invalid authorization response. Please try again.';
                case 'token_failed':
                    return 'Failed to get authorization token. Please try again.';
                case 'callback_failed':
                    return 'Authorization callback failed. Please try again.';
                default:
                    return 'An error occurred during authorization.';
            }
        }

        // ===========================================
        // DATA LOADING (Keep existing functionality)
        // ===========================================
        async function loadVendorData(token) {
            showLoadingState();
            
            try {
                console.log('📡 Fetching vendor profile...');
                const response = await fetch(`${API_BASE}/vendor-profile?token=${token}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                vendorData = await response.json();
                console.log('✅ Vendor data loaded:', vendorData);
                
                populateForm(vendorData);
                await loadOrganizationContacts(token);
                
            } catch (error) {
                console.error('💥 Failed to load vendor data:', error);
                throw error;
            }
        }

        async function loadOrganizationContacts(token) {
            console.log('👥 Loading organization contacts...');
            
            try {
                const response = await fetch(`${API_BASE}/get-organization-contacts?token=${token}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                organizationContacts = data.contacts;
                
                console.log(`✅ Loaded ${organizationContacts.length} contacts for ${data.organizationName}`);
                
            } catch (error) {
                console.error('💥 Error loading contacts:', error);
                // Don't throw - contacts are optional
            }
        }

        function populateForm(data) {
            console.log('📝 Populating form with:', data);
            
            // Update booth info
            document.getElementById('boothNumber').textContent = `Booth ${data.boothNumber}`;
            
            // Store data for later use in form steps
            window.formData = {
                organization: data.organization,
                boothNumber: data.boothNumber
            };
        }

        // ===========================================
        // UTILITY FUNCTIONS
        // ===========================================
        function handleFileSelect(input, displayElementId) {
            const file = input.files[0];
            const displayElement = document.getElementById(displayElementId);
            
            if (file) {
                displayElement.textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                displayElement.style.color = '#28a745';
            } else {
                displayElement.textContent = '';
            }
        }

        // Keep all existing form submission logic here...
        // (This will be added when we build the individual step forms)
    </script>
</body>
</html>
