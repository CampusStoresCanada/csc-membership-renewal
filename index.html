<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Booth Profile - CSC Conference</title>
    <link rel="stylesheet" href="https://use.typekit.net/ilr6ctr.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'davis-sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 3vh 3vw;
        }

        /* Background image - right side only in landscape */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 20%;
            height: 100%;
            background: url('https://images.squarespace-cdn.com/content/v1/5cf7db4cc0827b0001c9ff81/b115546f-0ea2-4efc-8401-79d0991119ce/Background+art.png?format=2500w') no-repeat right center;
            background-size: cover;
            z-index: -1;
        }

        /* DESKTOP: Container */
        .wizard-container {
            display: flex;
            width: 100%;
            height: calc(100vh - 6vh);
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.66);
            border-radius: 20px;
            border: 3px solid #000000;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 23vw;
            height: 100%;
            background: #e6e6e6;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            box-shadow: 6px 0 16px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }

        .logo-section {
            margin-bottom: 6vw;
            width: 100%;
        }

        .logo-and-title {
            display: flex;
            align-items: flex-start;
            gap: 1vw;
            height: 5vw;
            margin-bottom: 2vw;
        }

        .logo {
            width: 5vw;
            height: 5vw;
            flex-shrink: 1;
        }

        .logo-text {
            flex: 1;
            height: 5vw;
            display: flex;
            flex-direction: column;
            justify-content: left;
        }

        .booth-section {
            width: 100%;
            margin-left: 4.9vw;
        }

        .conference-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 1.6vw;
            color: #000000;
            line-height: 1.15;
            margin: 0;
        }

        .booth-number {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 2.1vw;
            color: #000000;
            margin: 0;
            line-height: 1;
        }

        /* Step Navigation */
        .step-navigation {
            flex: 1;
        }

        .step-item {
            display: flex;
            align-items: center;
            margin-bottom: 2vw;
            padding: 0.8vw 0;
        }

        .step-number {
            width: 2vw;
            height: 2vw;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.2vw;
            flex-shrink: 0;
        }

        .step-number svg {
            width: 1.4vw;
            height: 1.4vw;
        }

        .step-title {
            font-weight: 500;
            font-size: 1.2vw;
            color: #333333;
            line-height: 1.2;
        }

        /* Active step styling */
        .step-item.active .step-number svg {
            fill: #0071bc !important;
        }

        .step-item.active .step-title {
            color: #0071bc;
            font-weight: 700;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 0px 60px 80px 5%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            position: relative;
            min-height: 400px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Welcome Screen */
        .welcome-section {
            width: 50%;
            max-width: none;
            margin-top: 140px;
        }

        .welcome-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 3.0vw;
            color: #000000;
            margin-bottom: 30px;
            line-height: 1.1;
        }

        .welcome-text {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.0vw;
            color: #808080;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        /* Step Content Styles */
        .step-header {
            margin-bottom: 40px;
            margin-top: 60px;
        }

        .step-title-main {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 3.0vw;
            color: #000000;
            margin-bottom: 15px;
            line-height: 1.1;
        }

        .step-subtitle {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.0vw;
            color: #808080;
            line-height: 1.4;
            margin: 0;
        }

        /* Form Styles - Remove Width Constraints */
        .form-container {
            max-width: none; /* Remove the constraint! */
            width: 100%;
        }

        .form-field {
            margin-bottom: 1.5vw;
            position: relative; /* Add positioning context for absolute positioned children */
            width: 100%;
        }

        /* Company Name - Large Bold Display */
        .form-field:first-child .field-display {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 1.8vw;
            color: #000000;
            line-height: 1.2;
            display: inline-block;
        }

        .form-field:first-child .edit-btn {
            display: inline-flex;
            margin-left: 0.8vw;
            vertical-align: middle;
        }

        /* Website - Smaller, lighter */
        .form-field:nth-child(2) .field-display {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.0vw;
            color: #666666;
            line-height: 1.2;
            display: inline-block;
        }

        .form-field:nth-child(2) .edit-btn {
            display: inline-flex;
            margin-left: 0.8vw;
            vertical-align: middle;
        }

        /* Description - Paragraph text with inline edit button */
        .form-field[data-field="description"] .field-display {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.0vw;
            color: #666666;
            line-height: 1.5;
            display: block; /* Changed from inline-block */
            margin-bottom: 0.5vw;
            width: 38vw; /* Force width constraint instead of just max-width */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .form-field[data-field="description"] .edit-btn {
            display: flex;
            position: absolute;
            top: 50%; 
            left: 38.8vw;
            transform: translateY(-50%);
        }

        .edit-btn {
            background: none;
            border: none;
            color: #999999;
            cursor: pointer;
            padding: 0.2vw;
            align-items: center;
            justify-content: center;
            border-radius: 0.2vw;
            transition: all 0.2s ease;
            width: 1.2vw;
            height: 1.2vw;
        }

        .edit-btn svg {
            width: 1vw;
            height: 1vw;
        }

        .edit-btn:hover {
            color: #666666;
        }

        .field-display.placeholder {
            color: #999999;
            font-style: italic;
        }

        /* ===========================================
           ANIMATED FIELD SYSTEM
           =========================================== */

        /* Field Overlay System */
        .field-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }

        .field-overlay.active {
            pointer-events: all;
        }

        /* Border with Simple Single Sweep */
        .field-border {
            position: absolute;
            border: 2px solid transparent;
            border-radius: 8px;
            background: transparent;
            pointer-events: none;
            position: relative;
        }

        .field-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #0071bc;
            border-radius: 8px;
            
            /* Simple single sweep from left to right */
            clip-path: inset(0 100% 0 0);
            animation: drawBorderSweep 0.3s ease-out forwards;
        }

        @keyframes drawBorderSweep {
            from { clip-path: inset(0 100% 0 0); }    /* Hidden */
            to { clip-path: inset(0 0 0 0); }         /* Fully visible */
        }

        /* Simple Label - No Animation */
        .field-label {
            position: absolute;
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 0.9vw;
            color: #0071bc;
            background: #ffffff;
            padding: 0 0.4vw;
            white-space: nowrap;
        }

        .field-label.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        /* Input Field Positioning - 38vw Width */
        .field-input-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 38vw; /* Match mockup proportions */
            max-width: 38vw; /* Ensure it never exceeds this */
        }

        .field-input, .field-select, .field-textarea {
            border: none;
            outline: none;
            background: transparent;
            font-family: 'davis-sans', sans-serif;
            color: #000000;
            padding: 0;
            margin: 0;
            width: 100%;
            max-width: 100%; /* Stay within container */
            resize: none;
        }

        /* Match font styles to display elements */
        .field-input.company-name {
            font-weight: 700;
            font-size: 1.8vw;
            line-height: 1.2;
        }

        .field-input.website {
            font-weight: 400;
            font-size: 1.0vw;
            line-height: 1.2;
        }

        /* Custom Dropdown - Complete replacement for HTML select */
        .custom-dropdown {
            position: relative;
            width: 38vw;
            margin-left: -18px; /* Align text content with other fields (border 2px + padding 16px) */
        }

        .dropdown-display {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid #cccccc;
            border-radius: 8px;
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.2vw;
            line-height: 1.2;
            color: #333333;
            background: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color 0.2s ease;
        }

        .dropdown-display:hover {
            border-color: #0071bc;
        }

        .dropdown-display.open {
            border-color: #0071bc;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .dropdown-display.placeholder {
            color: #999999;
            font-style: italic;
        }

        .dropdown-arrow {
            width: 16px;
            height: 12px;
            pointer-events: none;
            transition: transform 0.2s ease;
        }

        .dropdown-display.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 2px solid #0071bc;
            border-top: none;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-option {
            padding: 8px 16px;
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.2vw;
            line-height: 1.2;
            color: #0071bc;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dropdown-option:hover {
            background-color: #e3f2fd;
        }

        .dropdown-option.selected {
            background-color: #e3f2fd;
        }

        .placeholder-option {
            color: #999999 !important;
            font-style: italic;
            cursor: default !important;
        }

        .placeholder-option:hover {
            background-color: transparent !important;
        }

        .category-dropdown-arrow {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 12px;
            pointer-events: none;
        }

        .field-textarea.description {
            font-weight: 400;
            font-size: 1.0vw;
            line-height: 1.5;
            min-height: 6vw;
            max-width: 38vw; /* Ensure textarea doesn't exceed 38vw */
        }

        /* Character Counter for Description */
        .character-counter {
            position: absolute;
            bottom: 0.5vw;
            right: 0.8vw;
            font-family: 'davis-sans', sans-serif;
            font-size: 0.7vw;
            color: #0071bc;
            font-weight: 400;
            background: #ffffff;
            padding: 0.2vw 0.4vw;
            border-radius: 0.2vw;
            transition: all 0.2s ease;
        }

        .character-counter.warning {
            font-weight: 700;
            color: #0071bc;
        }

        /* Button Styles */
        .get-started-btn, .next-btn {
            background: #0071bc;
            color: #ffffff;
            border: none;
            width: max(12.5vw);
            min-width: 160px;
            height: auto;
            padding: max(1vw, 12px) max(1.5vw, 16px);
            border-radius: max(0.5vw, 6px);
            font-size: max(1.0vw, 14px);
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: max(0.5vw, 6px);
            position: absolute;
            right: max(5vw, 50px);
            bottom: max(3.5vw, 35px);
            z-index: 5;
            box-shadow: 6px 0 16px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        .get-started-btn:hover, .next-btn:hover {
            background: #005a94;
        }

        .previous-btn {
            background: #ffffff;
            color: #666666;
            border: 2px solid #cccccc;
            width: max(12.5vw);
            min-width: 160px;
            height: auto;
            padding: max(1vw, 12px) max(1.5vw, 16px);
            border-radius: max(0.5vw, 6px);
            font-size: max(1.0vw, 14px);
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: max(0.5vw, 6px);
            position: absolute;
            left: 0;
            bottom: max(3.5vw, 35px);
            z-index: 5;
            transition: all 0.2s ease;
        }

        .previous-btn:hover {
            background: #f8f8f8;
            border-color: #999999;
            color: #333333;
        }

        /* Loading State */
        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .loading-title {
            font-family: 'davis-sans', sans-serif;
            font-weight: 700;
            font-size: 48px;
            color: #000000;
            margin-bottom: 20px;
        }

        /* Content fade-in animation */
        .wizard-content {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            width: 100%;
            height: 100%;
        }

        .wizard-content.loaded {
            opacity: 1;
        }

        /* Error State */
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            display: none;
            font-size: 16px;
        }

        /* Success State */
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin: 20px;
            display: none;
        }

        .success h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        /* Mobile Progress Bar */
        .mobile-progress {
            display: none;
            height: 4px;
            background: #e6e6e6;
            position: relative;
            margin-bottom: 20px;
        }

        .mobile-progress-fill {
            height: 100%;
            background: #0071bc;
            transition: width 0.3s ease;
        }

        /* Responsive breakpoints */
        @media (max-width: 1000px) {
            .welcome-section {
                width: 60%;
            }
        }

        /* MOBILE/TABLET: Complete Layout Change */
        @media (orientation: portrait), (max-width: 768px) {
            body {
                padding: 0;
            }
            
            body::before {
                display: none;
            }
            
            .wizard-container {
                position: static;
                transform: none;
                width: 100%;
                height: auto;
                min-height: 100vh;
                max-width: none;
                margin: 0;
                border-radius: 0;
                border: none;
                flex-direction: column;
                box-shadow: none;
                background: #ffffff;
                display: flex;
            }

            .wizard-content {
                display: flex;
                flex-direction: column;
                width: 100%;
                min-height: 100vh;
            }

            .sidebar {
                width: 100%;
                padding: 20px;
                box-shadow: none;
                border-bottom: 1px solid #cccccc;
                flex-shrink: 0;
                height: auto;
                order: 1;
            }

            .main-content {
                padding: 20px;
                flex: 1;
                order: 2;
                display: flex;
                flex-direction: column;
            }

            .logo-and-title {
                height: auto;
                margin-bottom: 10px;
            }

            .logo {
                width: 40px;
                height: 40px;
            }

            .logo-text {
                height: auto;
            }

            .conference-title {
                font-size: 16px;
                margin-bottom: 5px;
            }

            .booth-section {
                margin-left: 55px;
                margin-top: 10px;
            }

            .booth-number {
                font-size: 20px;
            }

            .step-navigation {
                display: none;
            }

            .mobile-progress {
                display: block;
            }

            .welcome-section {
                width: 100%;
                max-width: none;
                margin-top: 0;
            }

            .welcome-title {
                font-size: 36px;
            }

            .welcome-text {
                font-size: 16px;
            }

            .get-started-btn, .next-btn, .previous-btn {
                position: static;
                transform: none;
                width: 100%;
                max-width: 300px;
                margin-top: 30px;
                font-size: 18px;
                right: auto;
                bottom: auto;
                left: auto;
                z-index: auto;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 36px;
            }

            .welcome-text {
                font-size: 14px;
            }

            .booth-number {
                font-size: 18px;
            }
        }
        /* ===========================================
           VALIDATION ERROR STYLES
           =========================================== */
        
        /* Error state for field borders */
        .field-border.error-state::before {
            border-color: #dc3545 !important; /* Red border */
        }
        
        /* Error state for category dropdown */
        .dropdown-display.error-state {
            border-color: #dc3545 !important; /* Red border */
        }
        
        /* Error pulse animation */
        @keyframes errorPulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 0 0 4px rgba(220, 53, 69, 0.2);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }
        
        /* Error message styling */
        .error-message {
            position: absolute;
            bottom: -25px;
            left: 0;
            font-family: 'davis-sans', sans-serif;
            font-size: 0.8vw;
            color: #dc3545;
            font-weight: 500;
            background: #ffffff;
            padding: 0.2vw 0.5vw;
            border-radius: 0.2vw;
            border: 1px solid #dc3545;
            white-space: nowrap;f
            z-index: 15;
            display: none;
        }
        
        /* Character counter warning state (keep existing) */
        .character-counter.warning {
            font-weight: 700;
            color: #0071bc;
        }
        
        /* Character counter for company name */
        .character-counter {
            position: absolute;
            font-family: 'davis-sans', sans-serif;
            font-size: 0.7vw;
            color: #0071bc;
            font-weight: 400;
            background: #ffffff;
            padding: 0.2vw 0.4vw;
            border-radius: 0.2vw;
            transition: all 0.2s ease;
            white-space: nowrap;
            z-index: 1;
        }
        
        /* Mobile responsive error styles */
        @media (orientation: portrait), (max-width: 768px) {
            .error-message {
                font-size: 12px;
                bottom: -20px;
            }
            
            .character-counter {
                font-size: 10px;
            }
            
            @keyframes errorPulse {
                0% { 
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
                }
                50% { 
                    transform: scale(1.05);
                    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
                }
                100% { 
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }
        }
        /* ===========================================
           STEP 2: CONFERENCE HIGHLIGHT STYLES
           =========================================== */
        
        .highlight-container {
            display: flex;
            gap: 40px;
            max-width: none;
            width: 100%;
        }
        
        /* Left side - Image Upload */
        .image-section {
            width: 280px;
            flex-shrink: 0;
        }
        
        .image-upload-container {
            position: relative;
            width: 100%;
            height: 500px; /* 9:16 aspect ratio for 280px width */
            border: 2px dashed #cccccc;
            border-radius: 12px;
            background: #f8f8f8;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .image-upload-container:hover {
            border-color: #0071bc;
            background: #f0f8ff;
        }
        
        .image-upload-container.dragover {
            border-color: #0071bc;
            background: #e3f2fd;
            transform: scale(1.02);
        }
        
        .image-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
        }
        
        .image-placeholder svg {
            width: 120px;
            height: 90px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        .image-placeholder-text {
            font-family: 'davis-sans', sans-serif;
            font-size: 14px;
            color: #666666;
            margin-bottom: 8px;
        }
        
        .image-placeholder-hint {
            font-family: 'davis-sans', sans-serif;
            font-size: 12px;
            color: #999999;
        }
        
        .uploaded-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'davis-sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .image-upload-container:hover .image-overlay {
            display: flex;
        }
        
        /* Right side - Text Fields */
        .content-section-right {
            flex: 1;
            min-width: 0;
        }
        
        .text-field {
            margin-bottom: 40px;
            position: relative;
        }
        
        .field-label-step2 {
            font-family: 'davis-sans', sans-serif;
            font-weight: 600;
            font-size: 1.2vw;
            color: #000000;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .field-display-step2 {
            font-family: 'davis-sans', sans-serif;
            font-weight: 400;
            font-size: 1.0vw;
            color: #666666;
            line-height: 1.5;
            min-height: 1.5em;
            cursor: pointer;
            padding: 12px 0;
        }
        
        .field-display-step2.placeholder {
            color: #999999;
            font-style: italic;
        }
        
        .field-display-step2.headline {
            font-size: 1.4vw;
            font-weight: 600;
            color: #000000;
        }
        
        /* Progress Bar */
        .upload-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
            display: none;
        }
        
        .upload-progress-fill {
            height: 100%;
            background: #0071bc;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Crop Modal */
        .crop-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .crop-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .crop-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .crop-title {
            font-family: 'davis-sans', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 8px;
        }
        
        .crop-subtitle {
            font-family: 'davis-sans', sans-serif;
            font-size: 14px;
            color: #666666;
        }
        
        .crop-image-container {
            width: 500px;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .crop-image {
            max-width: 100%;
            max-height: 100%;
        }
        
        .crop-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .crop-btn {
            padding: 12px 24px;
            border-radius: 6px;
            font-family: 'davis-sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .crop-btn.primary {
            background: #0071bc;
            color: white;
            border: none;
        }
        
        .crop-btn.primary:hover {
            background: #005a94;
        }
        
        .crop-btn.secondary {
            background: white;
            color: #666666;
            border: 2px solid #cccccc;
        }
        
        .crop-btn.secondary:hover {
            border-color: #999999;
            color: #333333;
        }
        
        /* Error Messages */
        .image-error-message {
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            display: none;
        }
        
        /* Hidden file input */
        .hidden-file-input {
            display: none;
        }
        
        /* Mobile responsive for Step 2 */
        @media (orientation: portrait), (max-width: 768px) {
            .highlight-container {
                flex-direction: column;
                gap: 20px;
            }
        
            .image-section {
                width: 100%;
            }
        
            .image-upload-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="loading-title">Loading...</div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error">
            <strong>Oops!</strong> <span id="errorMessage"></span>
        </div>

        <!-- Success State -->
        <div id="successState" class="success">
            <h3>✅ Profile Updated Successfully!</h3>
            <p>Thank you for completing your booth profile. Your information is now under review and will appear on the conference map once approved.</p>
        </div>

        <!-- All Content - Hidden until loaded -->
        <div class="wizard-content" id="wizardContent">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="logo-section">
                    <div class="logo-and-title">
                        <img src="https://images.squarespace-cdn.com/content/v1/5cf7db4cc0827b0001c9ff81/3c43cc7d-5f2a-4b5e-888e-887d3bb38ebc/Logo+Only.png?format=750w" alt="Campus Stores Conference" class="logo">
                        <div class="logo-text">
                            <div class="conference-title">CAMPUS STORES<br>CONFERENCE</div>
                        </div>
                    </div>
                    <div class="booth-section">
                        <div class="booth-number" id="boothNumber">Booth 501</div>
                    </div>
                </div>  
                <div class="crop-modal" id="cropModal">
                    <div class="crop-container">
                        <div class="crop-header">
                            <div class="crop-title">Crop your image</div>
                            <div class="crop-subtitle">Adjust the image to fit a 9:16 aspect ratio (portrait)</div>
                        </div>
                        <div class="crop-image-container">
                            <img class="crop-image" id="cropImage" alt="Image to crop">
                        </div>
                        <div class="crop-actions">
                            <button class="crop-btn secondary" onclick="cancelCrop()">Cancel</button>
                            <button class="crop-btn primary" onclick="applyCrop()">Apply Crop</button>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <div class="step-item" data-step="0">
                        <div class="step-number">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.01 28.01">
                                <path d="M14.01,28.01C6.28,28.01,0,21.73,0,14.01S6.28,0,14.01,0s14.01,6.28,14.01,14.01-6.28,14.01-14.01,14.01ZM14.01,2C7.39,2,2,7.39,2,14.01s5.39,12.01,12.01,12.01,12.01-5.39,12.01-12.01S20.63,2,14.01,2Z"/>
                                <path d="M13.25,22.55v-13.78l-1.63.89-1.06-1.8,4.51-2.4h.38v17.09h-2.21Z"/>
                            </svg>
                        </div>
                        <div class="step-title">Company information</div>
                    </div>
                    <div class="step-item" data-step="1">
                        <div class="step-number">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.04 28.01">
                                <path d="M13.98,28.01C6.25,28.01-.03,21.73-.03,14.01S6.25,0,13.98,0s14.01,6.28,14.01,14.01-6.28,14.01-14.01,14.01ZM13.98,2C7.36,2,1.97,7.39,1.97,14.01s5.39,12.01,12.01,12.01,12.01-5.39,12.01-12.01S20.6,2,13.98,2Z"/>
                                <path d="M8.94,22.55v-.82l5.21-7.15c1.44-1.97,2.18-3.34,2.18-4.73,0-1.66-1.06-2.47-2.42-2.47-1.46,0-2.47.94-2.47,2.35,0,1.27.84,1.78.84,1.78l-1.7,1.25s-1.44-1.15-1.44-3c0-1.49.96-4.3,4.99-4.3s4.58,2.98,4.58,4.51c0,.79-.12,2.16-2.06,4.8l-4.32,5.9h6.7v1.87h-10.08Z"/>
                            </svg>
                        </div>
                        <div class="step-title">Conference highlight</div>
                    </div>
                    <div class="step-item" data-step="2">
                        <div class="step-number">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.01 28.25">
                                <path d="M14.01,28.25C6.28,28.25,0,21.97,0,14.25S6.28.24,14.01.24s14.01,6.28,14.01,14.01-6.28,14.01-14.01,14.01ZM14.01,2.24C7.39,2.24,2,7.63,2,14.25s5.39,12.01,12.01,12.01,12.01-5.39,12.01-12.01S20.63,2.24,14.01,2.24Z"/>
                                <path d="M10.36,18.67c.46,1.03,1.46,2.33,3.41,2.33,2.09,0,3.1-1.51,3.1-3.43,0-1.8-.86-3.22-3.41-3.22h-1.32v-1.87h1.37c2.02,0,2.78-.89,2.78-2.47s-.79-2.52-2.35-2.52c-1.39,0-2.23.72-2.86,2.11l-1.73-1.10c.79-1.58,2.14-2.93,4.66-2.93,2.93,0,4.66,1.82,4.66,4.25s-1.63,3.24-2.4,3.48c.65.19,2.98.94,2.98,4.22s-2.45,5.42-5.47,5.42c-2.69,0-4.32-1.63-4.99-3.12l1.58-1.15Z"/>
                            </svg>
                        </div>
                        <div class="step-title">Conference team</div>
                    </div>
                    <div class="step-item" data-step="3">
                        <div class="step-number">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.01 28.01">
                                <path d="M14.01,28.01C6.28,28.01,0,21.73,0,14.01S6.28,0,14.01,0s14.01,6.28,14.01,14.01-6.28,14.01-14.01,14.01ZM14.01,2C7.39,2,2,7.39,2,14.01s5.39,12.01,12.01,12.01,12.01-5.39,12.01-12.01S20.63,2,14.01,2Z"/>
                                <path d="M15.23,22.31v-5.38h-6.84v-1.15l4.22-10.27h2.35l-3.84,9.55h4.1v-5.62h2.26v5.62h2.23v1.87h-2.23v5.38h-2.26Z"/>
                            </svg>
                        </div>
                        <div class="step-title">Product catalogue</div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Mobile Progress Bar -->
                <div class="mobile-progress">
                    <div class="mobile-progress-fill" style="width: 0%"></div>
                </div>

                <!-- Welcome Screen -->
                <div id="welcomeSection" class="content-section active">
                    <div class="welcome-section">
                        <h1 class="welcome-title">Welcome</h1>
                        <p class="welcome-text">
                            Thank you for being a valued partner of Campus Stores Canada! To help our conference attendees discover your amazing products and services, we'd love your help completing your booth profile.
                        </p>
                        <p class="welcome-text">
                            You'll be asked to provide <strong>company information</strong>, highlight a <strong>featured product or service</strong>, select your <strong>conference team members</strong>, and optionally upload a <strong>product catalogue</strong>.
                        </p>
                        <p class="welcome-text">
                            Your information will be reviewed by our team before appearing on the conference map. While we're here to help make everything look great, you know your business best, so please share what you think will be most helpful for our members.
                        </p>
                        <p class="welcome-text">
                            We truly appreciate you taking the time to do this - our members are going to love having this information available, and we're excited to showcase your participation at the conference!
                        </p>
                        <button class="get-started-btn" onclick="startWizard()">
                            Get started
                            <span>→</span>
                        </button>
                    </div>
                </div>

                <!-- Step 1: Company Information -->
                <div id="step1Section" class="content-section">
                    <div class="step-header">
                        <h2 class="step-title-main">Company information</h2>
                        <p class="step-subtitle">Please ensure the following information about your company is accurate:</p>
                    </div>

                    <div class="form-container">
                        <!-- Company Name Field -->
                        <div class="form-field" data-field="companyName">
                            <div class="field-display" id="companyNameDisplay">Loading...</div>
                            <button class="edit-btn" onclick="editField('companyName')" id="editCompanyName">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                    <path d="m14.5 5.5 4 4"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Website Field -->
                        <div class="form-field" data-field="website">
                            <div class="field-display" id="websiteDisplay">website (example.com)</div>
                            <button class="edit-btn" onclick="editField('website')" id="editWebsite">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                    <path d="m14.5 5.5 4 4"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Category Field -->
                        <div class="form-field" data-field="category">
                            <div class="custom-dropdown" id="categoryDropdown">
                                <div class="dropdown-display" id="categoryDisplay">
                                    <span id="categoryText">Select your primary category</span>
                                    <svg class="dropdown-arrow" viewBox="0 0 19.87 12.22">
                                        <path d="M19.68.11c-.21-.17-.52-.15-.7.07l-9.03,10.77-.02-.02-.02.02L.88.18C.7-.04.39-.06.18.11-.04.29-.06.61.11.82l9.42,11.22c.1.12.24.18.38.18h.04c.14,0,.28-.06.38-.18L19.75.82c.17-.21.15-.53-.07-.71Z" fill="#999999"/>
                                    </svg>
                                </div>
                                <div class="dropdown-options" id="categoryOptions" style="display: none;">
                                    <div class="dropdown-option" data-value="Accessories">Accessories</div>
                                    <div class="dropdown-option" data-value="Apparel">Apparel</div>
                                    <div class="dropdown-option" data-value="Books">Books</div>
                                    <div class="dropdown-option" data-value="Campus Living">Campus Living</div>
                                    <div class="dropdown-option" data-value="Food & Beverages">Food & Beverages</div>
                                    <div class="dropdown-option" data-value="Gifts & Promotional Products">Gifts & Promotional Products</div>
                                    <div class="dropdown-option" data-value="Graduation & Regalia">Graduation & Regalia</div>
                                    <div class="dropdown-option" data-value="Health & Beauty">Health & Beauty</div>
                                    <div class="dropdown-option" data-value="School Office & Lab Supplies">School Office & Lab Supplies</div>
                                    <div class="dropdown-option" data-value="Store Operations">Store Operations</div>
                                    <div class="dropdown-option" data-value="Technology & Electronics">Technology & Electronics</div>
                                    <div class="dropdown-option" data-value="Other">Other</div>
                                </div>
                            </div>
                        </div>

                        <!-- Company Description Field -->
                        <div class="form-field" data-field="description">
                            <div class="field-display" id="descriptionDisplay">Give our members an elevator pitch of who you are.</div>
                            <button class="edit-btn" onclick="editField('description')" id="editDescription">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                    <path d="m14.5 5.5 4 4"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <button class="previous-btn" onclick="previousStep()" id="prevBtn">
                        <span>←</span>
                        Previous step
                    </button>
                    <button class="next-btn" onclick="nextStep()" id="nextBtn">
                        Next step
                        <span>→</span>
                    </button>
                </div>

                <!-- Step 3: Conference Highlight -->
                <div id="step2Section" class="content-section">
                    <div class="step-header">
                        <h2 class="step-title-main">Conference highlight</h2>
                        <p class="step-subtitle">Here is your spot to give our members THE reason to book a meeting with you.</p>
                    </div>
                
                    <div class="highlight-container">
                        <!-- Left side - Image Upload -->
                        <div class="image-section">
                            <div class="image-upload-container" id="imageUploadContainer">
                                <div class="image-placeholder" id="imagePlaceholder">
                                    <svg viewBox="0 0 252.74 190.53">
                                        <rect x="12.43" y="22.27" width="217.87" height="145.54" rx="9.27" ry="9.27" transform="translate(-19.43 32.27) rotate(-14.03)" fill="#f2f2f2"/>
                                        <rect x="26.15" y="35" width="190.41" height="120.09" rx="9.27" ry="9.27" transform="translate(-19.43 32.27) rotate(-14.03)" fill="#ccc"/>
                                        <path d="M49.31,159.14l-3.42-13.7c-.22-.88-.22-1.8.01-2.68l12.98-50c.85-3.29,4.48-4.99,7.56-3.55l35.1,16.48c2.97,1.4,6.49-.15,7.48-3.28l2.7-8.57c.93-2.95,4.14-4.53,7.04-3.46l86.8,31.86c1.68.62,1.55,3.04-.19,3.48l-149.49,37.37c-2.91.73-5.85-1.04-6.58-3.95Z" fill="#f2f2f2"/>
                                        <circle cx="160.71" cy="49.15" r="14.61" fill="#f2f2f2"/>
                                        <rect x="34.87" y="45" width="217.87" height="145.54" rx="9.27" ry="9.27" fill="#f2f2f2"/>
                                        <rect x="48.6" y="57.72" width="190.41" height="120.09" rx="9.27" ry="9.27" fill="#ccc"/>
                                        <path d="M58.36,162.48v-14.12c0-.91.23-1.8.66-2.6l24.72-45.36c1.63-2.98,5.56-3.76,8.19-1.61l30.06,24.5c2.54,2.07,6.33,1.43,8.05-1.37l4.7-7.66c1.62-2.64,5.11-3.39,7.67-1.65l76.48,51.96c1.48,1.01.77,3.33-1.02,3.33H63.79c-3,0-5.43-2.43-5.43-5.43Z" fill="#f2f2f2"/>
                                        <circle cx="193.11" cy="82.78" r="14.61" fill="#f2f2f2"/>
                                    </svg>
                                    <div class="image-placeholder-text">Click image to change</div>
                                    <div class="image-placeholder-hint">JPG or PNG, max 12MB</div>
                                </div>
                                <img class="uploaded-image" id="uploadedImage" alt="Uploaded image">
                                <div class="image-overlay" id="imageOverlay">
                                    Click to change image
                                </div>
                                <div class="upload-progress" id="uploadProgress">
                                    <div class="upload-progress-fill" id="uploadProgressFill"></div>
                                </div>
                                <div class="image-error-message" id="imageError"></div>
                            </div>
                            <input type="file" class="hidden-file-input" id="fileInput" accept="image/jpeg,image/png">
                        </div>
                
                        <!-- Right side - Text Fields -->
                        <div class="content-section-right">
                            <!-- Headline Field -->
                            <div class="text-field">
                                <div class="field-label-step2">
                                    Headline
                                    <button class="edit-btn" onclick="editStep2Field('headline')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                            <path d="m14.5 5.5 4 4"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="field-display-step2 headline placeholder" id="headlineDisplay">
                                    Give your product or service a catchy headline
                                </div>
                            </div>
                
                            <!-- Description Field -->
                            <div class="text-field">
                                <div class="field-label-step2">
                                    Description
                                    <button class="edit-btn" onclick="editStep2Field('description')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                            <path d="m14.5 5.5 4 4"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="field-display-step2 placeholder" id="descriptionDisplay">
                                    Give a short description of what you are going to do for the members, not every carve out and caveat, but the gist.
                                </div>
                            </div>
                
                            <!-- The Deal Field -->
                            <div class="text-field">
                                <div class="field-label-step2">
                                    The deal
                                    <button class="edit-btn" onclick="editStep2Field('deal')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m18 2 4 4-14 14H4v-4L18 2z"/>
                                            <path d="m14.5 5.5 4 4"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="field-display-step2 placeholder" id="dealDisplay">
                                    What's your conference special? Free consultation? Discount? Bonus swag?
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Navigation Buttons -->
                    <button class="previous-btn" onclick="previousStep()" id="prevBtn">
                        <span>←</span>
                        Previous step
                    </button>
                    <button class="next-btn" onclick="nextStep()" id="nextBtn">
                        Next step
                        <span>→</span>
                    </button>
                </div>

                <!-- Step 3: Conference Team -->
                <div id="step3Section" class="content-section">
                    <h2>Conference Team</h2>
                    <!-- Content will be added here -->
                </div>

                <!-- Step 4: Product Catalogue -->
                <div id="step4Section" class="content-section">
                    <h2>Product Catalogue</h2>
                    <!-- Content will be added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        // WIZARD STATE MANAGEMENT
        // ===========================================
        let currentStep = 0;
        const totalSteps = 4;
        let vendorData = {};
        let organizationContacts = [];
        let conferenceTeam = [];
        let categoryDropdownOpen = false; // Track dropdown state globally
        let activeField = null;
        let formState = {
            companyName: '',
            website: '',
            category: '',
            description: ''
        };
        
        const API_BASE = '/api';
        
        // ===========================================
        // CROPPER MANAGEMENT
        // ===========================================
        let highlightFormState = {
            headline: '',
            description: '',
            deal: '',
            imageUrl: ''
        };
        
        let cropperInstance = null;
        let currentFile = null;
        let activeStep2Field = null;
        let initializedSteps = new Set();
        
        // ===========================================
        // CUSTOM DROPDOWN FUNCTIONALITY
        // ===========================================
            
        function initializeDropdown() {
            const dropdown = document.getElementById('categoryDropdown');
            const display = document.getElementById('categoryDisplay');
            const options = document.getElementById('categoryOptions');
            const text = document.getElementById('categoryText');
            
            // Click on display to toggle dropdown
            display.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = options.style.display === 'block';
                
                if (isOpen) {
                    closeDropdown();
                } else {
                    openDropdown();
                }
            });
            
            // Click on options
            options.addEventListener('click', (e) => {
                if (e.target.classList.contains('dropdown-option')) {
                    const value = e.target.getAttribute('data-value');
                    selectOption(value);
                    closeDropdown();
                    
                    // Clear any error state when user makes a selection
                    clearCategoryError();
                }
            });
            
            // Click outside to close
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    closeDropdown();
                }
            });
            
            function openDropdown() {
                options.style.display = 'block';
                display.classList.add('open');
                categoryDropdownOpen = true; // Set flag
                
                // Clear error state when opening (user is showing intent to fix)
                console.log('🔧 Clearing category error on dropdown open');
                clearCategoryError();
                
                // Highlight selected option
                const currentValue = formState.category;
                options.querySelectorAll('.dropdown-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.getAttribute('data-value') === currentValue) {
                        option.classList.add('selected');
                    }
                });
            }
            
            function closeDropdown() {
                options.style.display = 'none';
                display.classList.remove('open');
                categoryDropdownOpen = false; // Clear flag
            }
            
            function selectOption(value) {
                formState.category = value;
                text.textContent = value;
                display.classList.remove('placeholder');
                console.log('📝 Selected category:', value);
            }
        }
        let initializedSteps = new Set();

        function showStep(stepNumber) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
        
            // Show welcome or specific step
            if (stepNumber === 0) {
                document.getElementById('welcomeSection').classList.add('active');
            } else {
                document.getElementById(`step${stepNumber}Section`).classList.add('active');
                
                // ADD THIS: Lazy initialize Step 2 on first visit
                if (stepNumber === 2 && !initializedSteps.has(2)) {
                    initializeStep2();
                    initializedSteps.add(2);
                    console.log('🚀 Step 2 initialized on first visit!');
                }
            }
        }
        // Field configurations
        const fieldConfigs = {
            companyName: {
                label: 'Company name',
                type: 'input',
                inputClass: 'company-name',
                placeholder: 'Enter company name',
                maxLength: 100, // Added max length
                required: true   // Added required flag
            },
            website: {
                label: 'Website',
                type: 'input',
                inputClass: 'website',
                placeholder: 'example.com',
                required: false
            },
            description: {
                label: 'Company description',
                type: 'textarea',
                inputClass: 'description',
                placeholder: 'Give our members an elevator pitch of who you are.',
                maxLength: 300,
                required: false
            }
        };

        function editField(fieldName) {
            // Don't allow editing category - it has its own dropdown system
            if (fieldName === 'category') {
                return;
            }
            
            // Close any currently active field first (no animation)
            if (activeField && activeField !== fieldName) {
                closeField(activeField);
            }

            activeField = fieldName;
            const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);
            const displayElement = document.getElementById(`${fieldName}Display`);
            const editButton = document.getElementById(`edit${capitalizeFirst(fieldName)}`);
            
            // Get display element position and dimensions
            const displayRect = displayElement.getBoundingClientRect();
            const fieldRect = fieldElement.getBoundingClientRect();
            
            // Calculate relative position within the field container
            const relativeTop = displayRect.top - fieldRect.top;
            const relativeLeft = displayRect.left - fieldRect.left;
            
            // Hide display and edit button
            displayElement.style.opacity = '0';
            editButton.style.opacity = '0';
            
            // Create overlay system
            createFieldOverlay(fieldName, relativeLeft, relativeTop, displayRect.width, displayRect.height);
            
            console.log('📝 Editing field:', fieldName);
        }

        function closeField(fieldName) {
            // Remove overlay immediately (no animation)
            removeFieldOverlay(fieldName);
            
            // Show display and edit button
            const displayElement = document.getElementById(`${fieldName}Display`);
            const editButton = document.getElementById(`edit${capitalizeFirst(fieldName)}`);
            
            if (displayElement) displayElement.style.opacity = '1';
            if (editButton) editButton.style.opacity = '1';
        }

        function createFieldOverlay(fieldName, x, y, width, height) {
            const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);
            const config = fieldConfigs[fieldName];
            
            // Create overlay container
            const overlay = document.createElement('div');
            overlay.className = 'field-overlay active';
            overlay.id = `overlay-${fieldName}`;
            
            // Create border
            const border = document.createElement('div');
            border.className = 'field-border';
            
            // Create label
            const label = document.createElement('div');
            label.className = 'field-label';
            label.textContent = config.label;
            
            // Create input container
            const inputContainer = document.createElement('div');
            inputContainer.className = 'field-input-container';
            
            // Create input element
            let inputElement;
            if (config.type === 'select') {
                inputElement = document.createElement('select');
                inputElement.className = `field-select ${config.inputClass}`;
                config.options.forEach(option => {
                    const optionEl = document.createElement('option');
                    optionEl.value = option.value;
                    optionEl.textContent = option.text;
                    inputElement.appendChild(optionEl);
                });
            } else if (config.type === 'textarea') {
                inputElement = document.createElement('textarea');
                inputElement.className = `field-textarea ${config.inputClass}`;
                inputElement.maxLength = config.maxLength || 1000;
            } else {
                inputElement = document.createElement('input');
                inputElement.className = `field-input ${config.inputClass}`;
                inputElement.type = fieldName === 'website' ? 'url' : 'text';
            }
            
            inputElement.placeholder = config.placeholder;
            inputElement.value = formState[fieldName] || '';
            
            // Position input container to align text exactly with display text
            inputContainer.style.left = x + 'px';
            inputContainer.style.top = y + 'px';
            inputContainer.style.width = '38vw'; // Match mockup proportions
            
            if (config.type === 'textarea') {
                inputContainer.style.height = Math.max(height, 120) + 'px';
            } else {
                inputContainer.style.height = height + 'px';
            }
            
            // Position border around input - FIXED CALCULATION
            const padding = 16; // 1vw converted to pixels approximately
            const inputWidthVw = window.innerWidth * 0.38; // 38vw in pixels
            const borderWidth = inputWidthVw + (padding * 2);
            border.style.left = (x - padding) + 'px';
            border.style.top = (y - padding) + 'px';
            border.style.width = borderWidth + 'px';
            
            if (config.type === 'textarea') {
                border.style.height = (Math.max(height, 120) + padding * 2) + 'px';
            } else {
                border.style.height = (height + padding * 2) + 'px';
            }
            
            // Position label on border
            label.style.left = (x - padding + 12) + 'px';
            label.style.top = (y - padding - 9) + 'px';
            
            // Add character counter for description - positioned as sibling to border
            if (fieldName === 'description') {
                const counter = document.createElement('div');
                counter.className = 'character-counter';
                counter.id = `charCounter-${fieldName}`;
                counter.textContent = config.maxLength - (formState[fieldName] || '').length;
                
                // Position counter on bottom border line (same pattern as label on top)
                const borderHeight = config.type === 'textarea' ? Math.max(height, 120) + padding * 2 : height + padding * 2;
                counter.style.position = 'absolute';
                counter.style.right = (x - padding + 24) + 'px'; // 24px from right edge to clear corner radius
                counter.style.top = (y - padding + borderHeight - 9) + 'px'; // Centered on bottom border
                counter.style.background = '#ffffff';
                counter.style.padding = '0 0.4vw';
                counter.style.zIndex = '1'; // Ensure it appears above border
                
                overlay.appendChild(counter); // Sibling to border, not child
                
                inputElement.addEventListener('input', () => updateCharCounter(fieldName));
            }
            
            // Assemble overlay
            inputContainer.appendChild(inputElement);
            overlay.appendChild(border);
            overlay.appendChild(label);
            overlay.appendChild(inputContainer);
            
            // Add to field
            fieldElement.appendChild(overlay);
            
            // Trigger on next frame - no animations, just show everything
            requestAnimationFrame(() => {
                inputElement.focus();
                if (inputElement.select) inputElement.select();
            });
            
            // Add event listeners
            setupInputEventListeners(inputElement, fieldName);
        }

        function setupInputEventListeners(inputElement, fieldName) {
            inputElement.addEventListener('blur', () => {
                if (activeField === fieldName) {
                    saveField(fieldName);
                }
            });
            
            inputElement.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && fieldName !== 'description') {
                    inputElement.blur();
                } else if (e.key === 'Escape') {
                    cancelEdit(fieldName);
                }
            });
            
            if (fieldName === 'category') {
                inputElement.addEventListener('change', () => {
                    if (activeField === fieldName) {
                        saveField(fieldName);
                    }
                });
            }
        }

        function saveField(fieldName) {
            const overlay = document.getElementById(`overlay-${fieldName}`);
            if (!overlay) return;
            
            const inputElement = overlay.querySelector('input, select, textarea');
            const newValue = inputElement.value;
            
            // Don't allow empty category
            if (fieldName === 'category' && !newValue) {
                inputElement.focus();
                return;
            }
            
            // Update form state
            formState[fieldName] = newValue;
            
            // Update display
            updateFieldDisplay(fieldName, newValue);
            
            // Remove overlay
            removeFieldOverlay(fieldName);
            
            // Show display and edit button
            const displayElement = document.getElementById(`${fieldName}Display`);
            const editButton = document.getElementById(`edit${capitalizeFirst(fieldName)}`);
            displayElement.style.opacity = '1';
            editButton.style.opacity = '1';
            
            activeField = null;
            
            console.log('📝 Updated field:', fieldName, '=', newValue);
        }

        function cancelEdit(fieldName) {
            closeField(fieldName);
            activeField = null;
        }

        function removeFieldOverlay(fieldName) {
            const overlay = document.getElementById(`overlay-${fieldName}`);
            if (overlay) {
                overlay.remove();
            }
        }

        function updateFieldDisplay(fieldName, value) {
            if (fieldName === 'category') {
                // Update the custom dropdown display
                const text = document.getElementById('categoryText');
                const display = document.getElementById('categoryDisplay');
                if (text && display) {
                    if (value) {
                        text.textContent = value;
                        display.classList.remove('placeholder');
                    } else {
                        text.textContent = 'Select your primary category';
                        display.classList.add('placeholder');
                    }
                }
                return;
            }
            
            const display = document.getElementById(`${fieldName}Display`);
            if (!display) return; // Safety check
            
            if (fieldName === 'website') {
                // Strip https://, http://, and www. from display
                let cleanUrl = value || '';
                if (cleanUrl) {
                    cleanUrl = cleanUrl.replace(/^https?:\/\//, '').replace(/^www\./, '');
                }
                display.textContent = cleanUrl || 'website (example.com)';
                display.className = cleanUrl ? 'field-display' : 'field-display placeholder';
            } else if (fieldName === 'description') {
                display.textContent = value || 'Give our members an elevator pitch of who you are.';
                display.className = value ? 'field-display' : 'field-display placeholder';
            } else {
                display.textContent = value || 'Company name';
                display.className = value ? 'field-display' : 'field-display placeholder';
            }
        }

        function updateCharCounter(fieldName) {
            const counter = document.getElementById(`charCounter-${fieldName}`);
            const inputElement = document.querySelector(`#overlay-${fieldName} textarea`);
            if (!counter || !inputElement) return;
            
            const config = fieldConfigs[fieldName];
            const remaining = config.maxLength - inputElement.value.length;
            
            counter.textContent = remaining;
            counter.className = remaining <= 75 ? 'character-counter warning' : 'character-counter';
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // ===========================================
        // INITIALIZATION
        // ===========================================
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check for OAuth callback success/error
            if (urlParams.get('success') === 'true') {
                console.log('🎉 OAuth callback success!');
                showSuccessState();
                return;
            }
            
            if (urlParams.get('error')) {
                const error = urlParams.get('error');
                console.error('❌ OAuth callback error:', error);
                showErrorState(getErrorMessage(error));
                return;
            }
            
            // Normal page load - get token and load vendor data
            const token = urlParams.get('token');
            if (!token) {
                showErrorState('Invalid access link. Please check your email for the correct URL.');
                return;
            }

            try {
                console.log('🪄 Loading vendor data for token:', token);
                await loadVendorData(token);
                initializeDropdown(); // Initialize the custom dropdown
                showWelcomeScreen();
            } catch (error) {
                console.error('Error loading vendor data:', error);
                showErrorState('Unable to load your profile information. Please try again later.');
            }
        });

        // ===========================================
        // WIZARD NAVIGATION
        // ===========================================
        function startWizard() {
            currentStep = 1;
            showStep(currentStep);
            updateStepNavigation();
        }

        function nextStep() {
            // Save any active field before moving
            if (activeField) {
                saveField(activeField);
                // If validation failed, activeField will still be set
                if (activeField) return; // Don't proceed if validation failed
            }
            
            // Validate all fields before proceeding
            if (!validateAllFields()) {
                return; // Don't proceed if validation failed
            }
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                updateStepNavigation();
                updateMobileProgress();
            }
        }

        function previousStep() {
            // Save any active field before moving
            if (activeField) {
                saveField(activeField);
            }
            
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
                updateStepNavigation();
                updateMobileProgress();
            }
        }

        function showStep(stepNumber) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));

            // Show welcome or specific step
            if (stepNumber === 0) {
                document.getElementById('welcomeSection').classList.add('active');
            } else {
                document.getElementById(`step${stepNumber}Section`).classList.add('active');
            }
        }

        function updateStepNavigation() {
            // Remove active class from all steps
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to current step
            if (currentStep > 0) {
                const activeStepItem = document.querySelector(`[data-step="${currentStep - 1}"]`);
                if (activeStepItem) {
                    activeStepItem.classList.add('active');
                }
            }
        }

        function updateMobileProgress() {
            const progressFill = document.querySelector('.mobile-progress-fill');
            const progressPercent = ((currentStep - 1) / (totalSteps - 1)) * 100;
            progressFill.style.width = `${Math.max(0, progressPercent)}%`;
        }

        // ===========================================
        // STATE MANAGEMENT
        // ===========================================
        function showWelcomeScreen() {
            showStep(0);
            hideLoadingState();
            hideErrorState();
            hideSuccessState();
            // Fade in content
            document.getElementById('wizardContent').classList.add('loaded');
        }

        function showLoadingState() {
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('wizardContent').style.display = 'none';
            hideErrorState();
            hideSuccessState();
        }

        function hideLoadingState() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('wizardContent').style.display = 'flex';
        }

        function showErrorState(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').style.display = 'block';
            hideLoadingState();
            hideSuccessState();
        }

        function hideErrorState() {
            document.getElementById('errorState').style.display = 'none';
        }

        function showSuccessState() {
            document.getElementById('successState').style.display = 'block';
            hideLoadingState();
            hideErrorState();
        }

        function hideSuccessState() {
            document.getElementById('successState').style.display = 'none';
        }

        function getErrorMessage(error) {
            switch (error) {
                case 'oauth_denied':
                    return 'Google Drive authorization was denied. Your profile was saved without files.';
                case 'oauth_invalid':
                    return 'Invalid authorization response. Please try again.';
                case 'token_failed':
                    return 'Failed to get authorization token. Please try again.';
                case 'callback_failed':
                    return 'Authorization callback failed. Please try again.';
                default:
                    return 'An error occurred during authorization.';
            }
        }

        // ===========================================
        // DATA LOADING
        // ===========================================
        async function loadVendorData(token) {
            showLoadingState();
            
            try {
                console.log('📡 Fetching vendor profile...');
                const response = await fetch(`${API_BASE}/vendor-profile?token=${token}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                vendorData = await response.json();
                console.log('✅ Vendor data loaded:', vendorData);
                
                populateForm(vendorData);
                await loadOrganizationContacts(token);
                
            } catch (error) {
                console.error('💥 Failed to load vendor data:', error);
                throw error;
            }
        }

        async function loadOrganizationContacts(token) {
            console.log('👥 Loading organization contacts...');
            
            try {
                const response = await fetch(`${API_BASE}/get-organization-contacts?token=${token}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                organizationContacts = data.contacts;
                
                console.log(`✅ Loaded ${organizationContacts.length} contacts for ${data.organizationName}`);
                
            } catch (error) {
                console.error('💥 Error loading contacts:', error);
                // Don't throw - contacts are optional
            }
        }

        function populateForm(data) {
            console.log('📝 Populating form with:', data);
            
            // Update booth info
            document.getElementById('boothNumber').textContent = `Booth ${data.boothNumber}`;
            
            // Populate form state with organization data
            formState.companyName = data.organization?.name || '';
            formState.website = data.organization?.website || '';
            formState.category = data.organization?.primaryCategory || '';
            formState.description = data.organization?.description || '';
            
            // Update displays
            updateFieldDisplay('companyName', formState.companyName);
            updateFieldDisplay('website', formState.website);
            updateFieldDisplay('category', formState.category);
            updateFieldDisplay('description', formState.description);
            
            // Store data for later use in form steps
            window.formData = {
                organization: data.organization,
                boothNumber: data.boothNumber
            };
        }

        // ===========================================
        // UTILITY FUNCTIONS
        // ===========================================
        function handleFileSelect(input, displayElementId) {
            const file = input.files[0];
            const displayElement = document.getElementById(displayElementId);
            
            if (file) {
                displayElement.textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                displayElement.style.color = '#28a745';
            } else {
                displayElement.textContent = '';
            }
        }
        // ===========================================
        // VALIDATION SYSTEM
        // ===========================================
        
        function validateField(fieldName, value) {
            const validators = {
                companyName: (val) => {
                    if (!val || val.trim().length === 0) {
                        return 'Company name is required';
                    }
                    if (val.length > 100) {
                        return 'Company name cannot exceed 100 characters';
                    }
                    return null; // valid
                },
                
                category: (val) => {
                    if (!val || val.trim() === '') {
                        return 'Please select a category';
                    }
                    return null;
                },
                
                // Description and website don't need validation (description has char limit, website we don't care)
                description: () => null,
                website: () => null
            };
            
            return validators[fieldName] ? validators[fieldName](value) : null;
        }
        
        // ===========================================
        // ENHANCED SAVE FIELD WITH VALIDATION
        // ===========================================
        
        function saveField(fieldName) {
            const overlay = document.getElementById(`overlay-${fieldName}`);
            if (!overlay) return;
            
            const inputElement = overlay.querySelector('input, select, textarea');
            const newValue = inputElement.value;
            
            // Validate the field
            const errorMessage = validateField(fieldName, newValue);
            
            if (errorMessage) {
                // Show validation error
                showFieldError(fieldName, errorMessage);
                return; // Don't save, keep field open
            }
            
            // Clear any existing errors
            clearFieldError(fieldName);
            
            // Update form state
            formState[fieldName] = newValue;
            
            // Update display
            updateFieldDisplay(fieldName, newValue);
            
            // Remove overlay
            removeFieldOverlay(fieldName);
            
            // Show display and edit button
            const displayElement = document.getElementById(`${fieldName}Display`);
            const editButton = document.getElementById(`edit${capitalizeFirst(fieldName)}`);
            displayElement.style.opacity = '1';
            editButton.style.opacity = '1';
            
            activeField = null;
            
            console.log('📝 Updated field:', fieldName, '=', newValue);
        }
        
        // ===========================================
        // CATEGORY VALIDATION (Special Case)
        // ===========================================
        
        function validateCategorySelection() {
            // Don't validate if dropdown is currently open (user is actively fixing it)
            if (categoryDropdownOpen) {
                console.log('🔧 Skipping category validation - dropdown is open');
                return true; // Assume they're going to fix it
            }
            
            const errorMessage = validateField('category', formState.category);
            
            if (errorMessage) {
                showCategoryError();
                return false;
            }
            
            clearCategoryError();
            return true;
        }
        
        function showCategoryError() {
            const dropdown = document.getElementById('categoryDisplay');
            dropdown.classList.add('error-state');
            
            // Add pulsing animation
            dropdown.style.animation = 'errorPulse 1s ease-in-out infinite';
        }
        
        function clearCategoryError() {
            const dropdown = document.getElementById('categoryDisplay');
            dropdown.classList.remove('error-state');
            dropdown.style.animation = 'none'; // Force stop animation
            
            // Force a reflow to ensure animation stops immediately
            dropdown.offsetHeight;
            
            console.log('🔧 Category error cleared'); // Debug log
        }
        
        // ===========================================
        // FIELD ERROR DISPLAY
        // ===========================================
        
        function showFieldError(fieldName, message) {
            const overlay = document.getElementById(`overlay-${fieldName}`);
            if (!overlay) return;
            
            // Add error state to border
            const border = overlay.querySelector('.field-border');
            if (border) {
                border.classList.add('error-state');
                border.style.animation = 'errorPulse 1s ease-in-out infinite';
            }
            
            // Show error message
            let errorElement = overlay.querySelector('.error-message');
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.className = 'error-message';
                overlay.appendChild(errorElement);
            }
            
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function clearFieldError(fieldName) {
            const overlay = document.getElementById(`overlay-${fieldName}`);
            if (!overlay) return;
            
            // Remove error state from border
            const border = overlay.querySelector('.field-border');
            if (border) {
                border.classList.remove('error-state');
                border.style.animation = '';
            }
            
            // Hide error message
            const errorElement = overlay.querySelector('.error-message');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }
        
        // ===========================================
        // ENHANCED COMPANY NAME WITH CHARACTER COUNTER
        // ===========================================
        
        function createFieldOverlay(fieldName, x, y, width, height) {
            const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);
            const config = fieldConfigs[fieldName];
            
            // Create overlay container
            const overlay = document.createElement('div');
            overlay.className = 'field-overlay active';
            overlay.id = `overlay-${fieldName}`;
            
            // Create border
            const border = document.createElement('div');
            border.className = 'field-border';
            
            // Create label
            const label = document.createElement('div');
            label.className = 'field-label';
            label.textContent = config.label;
            
            // Create input container
            const inputContainer = document.createElement('div');
            inputContainer.className = 'field-input-container';
            
            // Create input element
            let inputElement;
            if (config.type === 'textarea') {
                inputElement = document.createElement('textarea');
                inputElement.className = `field-textarea ${config.inputClass}`;
                inputElement.maxLength = config.maxLength || 1000;
            } else {
                inputElement = document.createElement('input');
                inputElement.className = `field-input ${config.inputClass}`;
                inputElement.type = fieldName === 'website' ? 'url' : 'text';
                
                // Add maxLength for company name
                if (fieldName === 'companyName') {
                    inputElement.maxLength = 100;
                }
            }
            
            inputElement.placeholder = config.placeholder;
            inputElement.value = formState[fieldName] || '';
            
            // Position input container
            inputContainer.style.left = x + 'px';
            inputContainer.style.top = y + 'px';
            inputContainer.style.width = '38vw';
            
            if (config.type === 'textarea') {
                inputContainer.style.height = Math.max(height, 120) + 'px';
            } else {
                inputContainer.style.height = height + 'px';
            }
            
            // Position border
            const padding = 16;
            const inputWidthVw = window.innerWidth * 0.38;
            const borderWidth = inputWidthVw + (padding * 2);
            border.style.left = (x - padding) + 'px';
            border.style.top = (y - padding) + 'px';
            border.style.width = borderWidth + 'px';
            
            if (config.type === 'textarea') {
                border.style.height = (Math.max(height, 120) + padding * 2) + 'px';
            } else {
                border.style.height = (height + padding * 2) + 'px';
            }
            
            // Position label
            label.style.left = (x - padding + 12) + 'px';
            label.style.top = (y - padding - 9) + 'px';
            
            // Add character counter for fields that need it
            if (fieldName === 'description' || fieldName === 'companyName') {
                const counter = document.createElement('div');
                counter.className = 'character-counter';
                counter.id = `charCounter-${fieldName}`;
                
                const maxLength = fieldName === 'companyName' ? 100 : 300;
                counter.textContent = maxLength - (formState[fieldName] || '').length;
                
                // Position counter
                const borderHeight = config.type === 'textarea' ? Math.max(height, 120) + padding * 2 : height + padding * 2;
                counter.style.position = 'absolute';
                counter.style.right = (x - padding + 24) + 'px';
                counter.style.top = (y - padding + borderHeight - 9) + 'px';
                counter.style.background = '#ffffff';
                counter.style.padding = '0 0.4vw';
                counter.style.zIndex = '1';
                
                overlay.appendChild(counter);
                
                inputElement.addEventListener('input', () => updateCharCounter(fieldName));
            }
            
            // Assemble overlay
            inputContainer.appendChild(inputElement);
            overlay.appendChild(border);
            overlay.appendChild(label);
            overlay.appendChild(inputContainer);
            
            // Add to field
            fieldElement.appendChild(overlay);
            
            // Focus and setup
            requestAnimationFrame(() => {
                inputElement.focus();
                if (inputElement.select) inputElement.select();
            });
            
            // Add event listeners
            setupInputEventListeners(inputElement, fieldName);
        }
        
        // ===========================================
        // ENHANCED CHAR COUNTER FOR BOTH FIELDS
        // ===========================================
        
        function updateCharCounter(fieldName) {
            const counter = document.getElementById(`charCounter-${fieldName}`);
            const inputElement = document.querySelector(`#overlay-${fieldName} input, #overlay-${fieldName} textarea`);
            if (!counter || !inputElement) return;
            
            const maxLength = fieldName === 'companyName' ? 100 : 300;
            const remaining = maxLength - inputElement.value.length;
            
            counter.textContent = remaining;
            
            // Warning threshold: last 10 for company name, last 75 for description
            const warningThreshold = fieldName === 'companyName' ? 10 : 75;
            counter.className = remaining <= warningThreshold ? 'character-counter warning' : 'character-counter';
        }
        
        // ===========================================
        // STEP VALIDATION BEFORE PROGRESSION
        // ===========================================
        
        function nextStep() {
            // Save any active field before moving
            if (activeField) {
                saveField(activeField);
                // If validation failed, activeField will still be set
                if (activeField) return; // Don't proceed if validation failed
            }
            
            // Validate all fields before proceeding
            if (!validateAllFields()) {
                return; // Don't proceed if validation failed
            }
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                updateStepNavigation();
                updateMobileProgress();
            }
        }
        
        function validateAllFields() {
            let allValid = true;
            
            // Check company name
            const companyNameError = validateField('companyName', formState.companyName);
            if (companyNameError) {
                console.log('❌ Company name validation failed:', companyNameError);
                allValid = false;
            }
            
            // Check category
            if (!validateCategorySelection()) {
                console.log('❌ Category validation failed');
                allValid = false;
            }
            
            return allValid;
        }
        function validateField(fieldName, value) {
            const validators = {
                companyName: (val) => {
                    if (!val || val.trim().length === 0) {
                        return 'Company name is required';
                    }
                    if (val.length > 100) {
                        return 'Company name cannot exceed 100 characters';
                    }
                    return null; // valid
                },
                
                category: (val) => {
                    if (!val || val.trim() === '') {
                        return 'Please select a category';
                    }
                    return null;
                },
                
                // Description and website don't need validation
                description: () => null,
                website: () => null
            };
            
            return validators[fieldName] ? validators[fieldName](value) : null;
        }
        
        function validateCategorySelection() {
            // Don't validate if dropdown is currently open (user is actively fixing it)
            if (categoryDropdownOpen) {
                console.log('🔧 Skipping category validation - dropdown is open');
                return true; // Assume they're going to fix it
            }
            
            const errorMessage = validateField('category', formState.category);
            
            if (errorMessage) {
                showCategoryError();
                return false;
            }
            
            clearCategoryError();
            return true;
        }
        
        function showCategoryError() {
            const dropdown = document.getElementById('categoryDisplay');
            dropdown.classList.add('error-state');
            
            // Add pulsing animation
            dropdown.style.animation = 'errorPulse 1s ease-in-out infinite';
        }
        
        function clearCategoryError() {
            const dropdown = document.getElementById('categoryDisplay');
            dropdown.classList.remove('error-state');
            dropdown.style.animation = 'none'; // Force stop animation
            
            // Force a reflow to ensure animation stops immediately
            dropdown.offsetHeight;
            
            console.log('🔧 Category error cleared'); // Debug log
        }
        
        function validateAllFields() {
            let allValid = true;
            
            // Check company name
            const companyNameError = validateField('companyName', formState.companyName);
            if (companyNameError) {
                console.log('❌ Company name validation failed:', companyNameError);
                allValid = false;
            }
            
            // Check category
            if (!validateCategorySelection()) {
                console.log('❌ Category validation failed');
                allValid = false;
            }
            
            return allValid;
        }
    function initializeStep2() {
        initializeImageUpload();
        initializeStep2TextFields();
    }
    
    function initializeImageUpload() {
        const container = document.getElementById('imageUploadContainer');
        const fileInput = document.getElementById('fileInput');
    
        if (!container || !fileInput) return;
    
        container.addEventListener('click', () => fileInput.click());
    
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelection(e.target.files[0]);
            }
        });
    
        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            container.classList.add('dragover');
        });
    
        container.addEventListener('dragleave', () => {
            container.classList.remove('dragover');
        });
    
        container.addEventListener('drop', (e) => {
            e.preventDefault();
            container.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleFileSelection(e.dataTransfer.files[0]);
            }
        });
    }
    
    function handleFileSelection(file) {
        if (!file.type.match(/^image\/(jpeg|jpg|png)$/i)) {
            showImageError('Please select a JPEG or PNG image file.');
            return;
        }
    
        const maxSize = 12 * 1024 * 1024; // 12MB
        if (file.size > maxSize) {
            showImageError('File size exceeds 12MB limit. Please choose a smaller image or reduce the quality.');
            return;
        }
    
        console.log('📸 Valid file selected:', file.name);
        currentFile = file;
        showCropModal(file);
    }
    
    function showImageError(message) {
        const errorElement = document.getElementById('imageError');
        if (!errorElement) return;
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        setTimeout(() => errorElement.style.display = 'none', 5000);
    }
    
    function showCropModal(file) {
        const modal = document.getElementById('cropModal');
        const cropImage = document.getElementById('cropImage');
        
        const reader = new FileReader();
        reader.onload = (e) => {
            cropImage.src = e.target.result;
            modal.style.display = 'flex';
            
            if (cropperInstance) cropperInstance.destroy();
            
            cropperInstance = new Cropper(cropImage, {
                aspectRatio: 9/16,
                viewMode: 1,
                autoCropArea: 1,
                responsive: true,
                background: false,
                movable: true,
                scalable: true,
                rotatable: false,
                zoomable: true
            });
        };
        reader.readAsDataURL(file);
    }
    
    function cancelCrop() {
        const modal = document.getElementById('cropModal');
        if (modal) modal.style.display = 'none';
        if (cropperInstance) {
            cropperInstance.destroy();
            cropperInstance = null;
        }
        currentFile = null;
        const fileInput = document.getElementById('fileInput');
        if (fileInput) fileInput.value = '';
    }
    
    function applyCrop() {
        if (!cropperInstance) return;
        
        const canvas = cropperInstance.getCroppedCanvas({
            width: 540,
            height: 960,
            imageSmoothingEnabled: true,
            imageSmoothingQuality: 'high'
        });
        
        canvas.toBlob((blob) => {
            if (blob) uploadImageToS3(blob);
        }, 'image/jpeg', 0.9);
        
        cancelCrop();
    }
    
    async function uploadImageToS3(blob) {
        console.log('📤 Starting S3 upload...');
        
        const progressContainer = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('uploadProgressFill');
        
        if (progressContainer && progressFill) {
            progressContainer.style.display = 'block';
            
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 30;
                if (progress > 90) progress = 90;
                progressFill.style.width = progress + '%';
            }, 200);
    
            try {
                const organizationName = formState?.companyName || 'Demo Company';
                const token = new URLSearchParams(window.location.search).get('token') || 'demo-token';
                const base64 = await blobToBase64(blob);
                
                const uploadData = {
                    files: [{
                        name: `highlight-image-${Date.now()}.jpg`,
                        content: base64.split(',')[1],
                        type: 'image/jpeg',
                        fieldName: 'highlightImage'
                    }],
                    organizationName: organizationName,
                    token: token
                };
    
                const response = await fetch(`${API_BASE}/upload-to-s3`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(uploadData)
                });
    
                if (!response.ok) throw new Error(`Upload failed: ${response.status}`);
    
                const result = await response.json();
                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressFill.style.width = '0%';
                }, 1000);
    
                const imageUrl = result.uploadResults?.otherFiles?.[0]?.url;
                if (imageUrl) {
                    showUploadedImage(imageUrl);
                    highlightFormState.imageUrl = imageUrl;
                    console.log('✅ Image uploaded successfully:', imageUrl);
                } else {
                    throw new Error('No image URL returned');
                }
    
            } catch (error) {
                console.error('💥 Upload failed:', error);
                clearInterval(progressInterval);
                progressContainer.style.display = 'none';
                progressFill.style.width = '0%';
                showImageError('Upload failed. Please try again.');
            }
        }
    }
    
    function blobToBase64(blob) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
        });
    }
    
    function showUploadedImage(imageUrl) {
        const placeholder = document.getElementById('imagePlaceholder');
        const uploadedImage = document.getElementById('uploadedImage');
        
        if (placeholder && uploadedImage) {
            placeholder.style.display = 'none';
            uploadedImage.src = imageUrl;
            uploadedImage.style.display = 'block';
        }
    }
    
    function initializeStep2TextFields() {
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('field-display-step2')) {
                const fieldName = getStep2FieldName(e.target);
                if (fieldName) editStep2Field(fieldName);
            }
        });
    }
    
    function getStep2FieldName(displayElement) {
        if (displayElement.id === 'headlineDisplay') return 'headline';
        if (displayElement.id === 'descriptionDisplay') return 'description';
        if (displayElement.id === 'dealDisplay') return 'deal';
        return null;
    }
    
    function editStep2Field(fieldName) {
        if (activeStep2Field) saveStep2Field(activeStep2Field);
    
        activeStep2Field = fieldName;
        const displayElement = document.getElementById(`${fieldName}Display`);
        const fieldElement = displayElement.parentNode;
        
        displayElement.style.display = 'none';
        
        const overlay = document.createElement('div');
        overlay.className = 'field-overlay';
        overlay.id = `step2-overlay-${fieldName}`;
        
        let inputElement;
        if (fieldName === 'description') {
            inputElement = document.createElement('textarea');
            inputElement.className = 'field-input field-textarea';
            inputElement.rows = 4;
        } else {
            inputElement = document.createElement('input');
            inputElement.className = `field-input ${fieldName === 'headline' ? 'headline' : ''}`;
            inputElement.type = 'text';
        }
        
        inputElement.value = highlightFormState[fieldName] || '';
        inputElement.placeholder = getStep2PlaceholderText(fieldName);
        
        overlay.appendChild(inputElement);
        fieldElement.appendChild(overlay);
        
        inputElement.focus();
        setupStep2InputListeners(inputElement, fieldName);
    }
    
    function setupStep2InputListeners(inputElement, fieldName) {
        inputElement.addEventListener('blur', () => {
            if (activeStep2Field === fieldName) saveStep2Field(fieldName);
        });
        
        inputElement.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && fieldName !== 'description') {
                inputElement.blur();
            } else if (e.key === 'Escape') {
                cancelStep2Edit(fieldName);
            }
        });
    }
    
    function saveStep2Field(fieldName) {
        const overlay = document.getElementById(`step2-overlay-${fieldName}`);
        if (!overlay) return;
        
        const inputElement = overlay.querySelector('input, textarea');
        const newValue = inputElement.value.trim();
        
        highlightFormState[fieldName] = newValue;
        updateStep2FieldDisplay(fieldName, newValue);
        
        overlay.remove();
        document.getElementById(`${fieldName}Display`).style.display = 'block';
        activeStep2Field = null;
        
        console.log('📝 Updated Step 2 field:', fieldName, '=', newValue);
    }
    
    function cancelStep2Edit(fieldName) {
        const overlay = document.getElementById(`step2-overlay-${fieldName}`);
        if (overlay) overlay.remove();
        document.getElementById(`${fieldName}Display`).style.display = 'block';
        activeStep2Field = null;
    }
    
    function updateStep2FieldDisplay(fieldName, value) {
        const display = document.getElementById(`${fieldName}Display`);
        if (!display) return;
        
        if (value) {
            display.textContent = value;
            display.classList.remove('placeholder');
        } else {
            display.textContent = getStep2PlaceholderText(fieldName);
            display.classList.add('placeholder');
        }
    }
    
    function getStep2PlaceholderText(fieldName) {
        const placeholders = {
            headline: 'Give your product or service a catchy headline',
            description: 'Give a short description of what you are going to do for the members, not every carve out and caveat, but the gist.',
            deal: "What's your conference special? Free consultation? Discount? Bonus swag?"
        };
        return placeholders[fieldName] || '';
    }
    </script>
</body>
</html>
